//[[Rcpp::export]]
NumericVector calculate_confirmation_incidence(NumericVector onsets, NumericVector shapes, NumericVector scales, int tmax){
  NumericVector confirmations(tmax+1);
  NumericVector onsets_subset;
  IntegerVector seqs;
  
  NumericVector probs;
  
  double shape1;
  double scale1;
  
  double tmp;
  double prob;
  
  // For each observation time
  for(int t = 0; t <= tmax; ++t){
    seqs = seq(0, t);
    tmp = 0;
    
    // Get all onsets on all preceding days
    for(int j = 0; j <= t; ++j){
      shape1 = shapes[j];
      scale1 = scales[j];
      
      // Probability that an onset t-j days prior to t is reported today
      prob = R::pgamma(t-j + 1, shape1, scale1, true, false) - R::pgamma(t-j, shape1, scale1, true, false);
      tmp += prob*onsets[j];
    }
    confirmations[t] = tmp;
  }
  return(confirmations);
}

//[[Rcpp::export]]
NumericVector calculate_onset_incidence(NumericVector infections, double weibull_alpha, double weibull_sigma, int tmax){
  NumericVector onsets(tmax+1);
  NumericVector infections_subset;
  IntegerVector seqs;
  NumericVector probs;
  
  for(int t = 0; t <= tmax; ++t){
    seqs = seq(0, t);
    infections_subset = infections[seqs];
    //probs = onset_probs[t-seqs+1];
    probs = Rcpp::pweibull(t-seqs+1, weibull_alpha, weibull_sigma,true,false) - Rcpp::pweibull(t-seqs, weibull_alpha, weibull_sigma,true,false);
    probs = probs*infections_subset;
      
    onsets[t] = sum(probs);
  }
  return(onsets);
}
